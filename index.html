<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Neon Chat Pro</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&family=Orbitron:wght@700&display=swap" rel="stylesheet">
    <style>
        :root { --primary: #007bff; --neon-pink: #ff007f; --bg: #f4f7f6; --glass: rgba(255, 255, 255, 0.95); }
        * { box-sizing: border-box; -webkit-tap-highlight-color: transparent; outline: none; }
        body { background: var(--bg); font-family: 'Poppins', sans-serif; margin: 0; height: 100vh; overflow: hidden; }

        /* SCREENS */
        .screen { position: fixed; inset: 0; background: white; z-index: 500; display: flex; align-items: center; justify-content: center; padding: 20px; transition: 0.5s; }
        .card { background: white; width: 100%; max-width: 400px; padding: 30px; border-radius: 30px; box-shadow: 0 20px 50px rgba(0,0,0,0.1); text-align: center; }
        .logo { font-family: 'Orbitron'; color: var(--primary); font-size: 2.2rem; margin-bottom: 10px; }
        input { width: 100%; padding: 15px; margin: 10px 0; border-radius: 15px; border: 1.5px solid #eee; background: #f9f9f9; font-size: 1rem; }
        .btn { width: 100%; padding: 15px; border-radius: 15px; border: none; background: var(--primary); color: white; font-weight: bold; cursor: pointer; font-size: 1rem; box-shadow: 0 10px 20px rgba(0,123,255,0.2); }

        /* MAIN APP UI */
        #mainApp { display: none; flex-direction: column; height: 100vh; background: #fff; }
        header { padding: 15px 20px; display: flex; align-items: center; justify-content: space-between; background: white; border-bottom: 1px solid #f0f0f0; }
        
        /* SEARCH & SUGGESTIONS */
        .search-wrap { position: relative; flex: 1; margin: 0 15px; }
        #suggestionBox { position: absolute; top: 50px; width: 100%; background: white; border-radius: 15px; box-shadow: 0 10px 30px rgba(0,0,0,0.1); z-index: 1000; display: none; overflow: hidden; }
        .s-item { padding: 12px 15px; display: flex; align-items: center; gap: 10px; cursor: pointer; border-bottom: 1px solid #f9f9f9; }
        .s-item:hover { background: #f0f7ff; }
        .s-avatar { width: 35px; height: 35px; border-radius: 50%; object-fit: cover; }

        /* CHAT AREA */
        #chatBox { flex: 1; overflow-y: auto; padding: 20px; display: flex; flex-direction: column; gap: 12px; background: #f8f9fa; }
        .msg { max-width: 75%; padding: 12px 18px; border-radius: 22px; font-size: 0.95rem; line-height: 1.5; position: relative; animation: pop 0.3s ease; }
        .msg-me { align-self: flex-end; background: var(--primary); color: white; border-bottom-right-radius: 4px; }
        .msg-them { align-self: flex-start; background: white; color: #333; border-bottom-left-radius: 4px; box-shadow: 0 4px 12px rgba(0,0,0,0.03); }
        .msg-img { width: 100%; border-radius: 15px; margin-top: 5px; cursor: pointer; }
        
        /* COUPLE MODE SPECIAL */
        .love-challenge { background: linear-gradient(45deg, #ff007f, #ff4757); color: white; padding: 15px; border-radius: 20px; text-align: center; margin: 10px 0; cursor: pointer; font-weight: bold; }

        /* INPUT BAR */
        .input-bar { padding: 15px 20px; display: flex; align-items: center; gap: 12px; background: white; border-top: 1px solid #f0f0f0; padding-bottom: 80px; }
        .action-btn { font-size: 1.6rem; cursor: pointer; color: #777; transition: 0.2s; }
        .action-btn:hover { color: var(--primary); transform: scale(1.1); }
        #msgIn { flex: 1; padding: 12px 20px; border-radius: 30px; border: 1.5px solid #eee; background: #f9f9f9; }

        @keyframes pop { from{transform:scale(0.8); opacity:0;} to{transform:scale(1); opacity:1;} }
        .hidden { display: none !important; }
        #ad-container { position: fixed; bottom: 0; left: 0; width: 100%; height: 60px; background: #fff; z-index: 2000; display: flex; justify-content: center; align-items: center; border-top: 1px solid #eee; }
    </style>
</head>
<body>

    <div id="authScreen" class="screen">
        <div class="card">
            <div class="logo">NEON CHAT</div>
            <p style="color:#888">Private & Secure Messenger</p>
            <input type="text" id="userIn" placeholder="Username">
            <input type="password" id="passIn" placeholder="Secret Password">
            <button class="btn" onclick="openProfile()">CONTINUE</button>
        </div>
    </div>

    <div id="profileScreen" class="screen hidden">
        <div class="card">
            <h2 style="font-family:'Orbitron'">YOUR PROFILE</h2>
            <div style="width:110px; height:110px; border-radius:50%; border:3px solid var(--primary); margin:0 auto 20px; overflow:hidden; cursor:pointer;" onclick="document.getElementById('dpIn').click()">
                <img src="https://api.dicebear.com/7.x/bottts/svg?seed=neon" id="dpPreview" style="width:100%; height:100%; object-fit:cover;">
            </div>
            <input type="file" id="dpIn" hidden accept="image/*" onchange="previewDP(this)">
            <input type="text" id="bioIn" placeholder="Your Status (e.g. In Love ‚ù§Ô∏è)">
            <button class="btn" onclick="startChatting()">SAVE & EXPLORE</button>
        </div>
    </div>

    <div id="mainApp">
        <header>
            <div class="logo" style="font-size:1.3rem;">NEON</div>
            <div class="search-wrap">
                <input type="text" id="searchIn" placeholder="Search friends..." oninput="liveSearch(this.value)">
                <div id="suggestionBox"></div>
            </div>
            <img id="topDp" src="" style="width:40px; height:40px; border-radius:50%; border:2px solid var(--primary);">
        </header>

        <div id="chatBox">
            <div class="love-challenge" onclick="sendChallenge()">‚ö° SEND LOVE CHALLENGE ‚ö°</div>
        </div>

        <div class="input-bar">
            <span class="action-btn" onclick="document.getElementById('imgIn').click()">üñºÔ∏è</span>
            <input type="file" id="imgIn" hidden accept="image/*" onchange="sendImage(this)">
            <input type="text" id="msgIn" placeholder="Type a message...">
            <button class="btn" style="width:60px; padding:10px;" onclick="sendText()">‚û§</button>
        </div>
    </div>

    <div id="ad-container">
        <script type="text/javascript">
            atOptions = { 'key' : '697d465f55b34630746380bf6791eb54', 'format' : 'iframe', 'height' : 50, 'width' : 320, 'params' : {} };
        </script>
        <script type="text/javascript" src="https://www.highperformanceformat.com/697d465f55b34630746380bf6791eb54/invoke.js"></script>
    </div>

    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-app-compat.js"></script>
    <script src="https://www.gstatic.com/firebasejs/9.0.0/firebase-database-compat.js"></script>

    <script>
        // ‚úÖ EXISTING CONFIG
        const firebaseConfig = {
            apiKey: "AIzaSyANEPedAQAd9VYnMMdw42Bjw_tQkBxxn2M",
            authDomain: "neon-game-hub.firebaseapp.com",
            databaseURL: "https://neon-game-hub-default-rtdb.firebaseio.com",
            projectId: "neon-game-hub",
            storageBucket: "neon-game-hub.firebasestorage.app",
            messagingSenderId: "636141968933",
            appId: "1:636141968933:web:60c7cc21d75883ef08a9cc"
        };
        firebase.initializeApp(firebaseConfig);
        const db = firebase.database();

        let myName, myDp, partner;

        function openProfile() {
            myName = document.getElementById('userIn').value.trim();
            if(!myName) return alert("Enter Username");
            document.getElementById('authScreen').classList.add('hidden');
            document.getElementById('profileScreen').classList.remove('hidden');
        }

        function previewDP(input) {
            const reader = new FileReader();
            reader.onload = e => { 
                document.getElementById('dpPreview').src = e.target.result;
                myDp = e.target.result;
            };
            reader.readAsDataURL(input.files[0]);
        }

        function startChatting() {
            document.getElementById('profileScreen').classList.add('hidden');
            document.getElementById('mainApp').style.display = 'flex';
            const finalDp = myDp || "https://api.dicebear.com/7.x/bottts/svg?seed="+myName;
            document.getElementById('topDp').src = finalDp;
            
            // Register User Directory
            db.ref('users/' + myName).set({ username: myName, dp: finalDp });
        }

        function liveSearch(query) {
            const box = document.getElementById('suggestionBox');
            if(!query) { box.style.display = 'none'; return; }
            
            db.ref('users').once('value', snap => {
                box.innerHTML = "";
                let found = false;
                snap.forEach(child => {
                    let user = child.val();
                    if(user.username.toLowerCase().includes(query.toLowerCase()) && user.username !== myName) {
                        found = true;
                        const div = document.createElement('div');
                        div.className = "s-item";
                        div.innerHTML = `<img src="${user.dp}" class="s-avatar"><span>${user.username}</span>`;
                        div.onclick = () => { partner = user.username; box.style.display = 'none'; loadChat(); };
                        box.appendChild(div);
                    }
                });
                box.style.display = found ? 'block' : 'none';
            });
        }

        function loadChat() {
            const chatId = [myName, partner].sort().join("_");
            db.ref('chats/' + chatId).on('value', snap => {
                const box = document.getElementById('chatBox');
                box.innerHTML = `<div class="love-challenge" onclick="sendChallenge()">‚ö° SEND LOVE CHALLENGE ‚ö°</div>`;
                if(!snap.val()) return;
                Object.values(snap.val()).forEach(m => {
                    const div = document.createElement('div');
                    div.className = `msg ${m.from === myName ? 'msg-me' : 'msg-them'}`;
                    if(m.type === 'text') div.innerText = m.val;
                    else if(m.type === 'img') div.innerHTML = `<img src="${m.val}" class="msg-img">`;
                    else div.innerHTML = `<div style="color:yellow">üèÜ CHALLENGE: ${m.val}</div>`;
                    box.appendChild(div);
                });
                box.scrollTop = box.scrollHeight;
            });
        }

        function sendText() {
            const val = document.getElementById('msgIn').value.trim();
            if(!val || !partner) return;
            pushMsg({ from: myName, type: 'text', val: val });
            document.getElementById('msgIn').value = "";
        }

        function sendImage(input) {
            const reader = new FileReader();
            reader.onload = e => pushMsg({ from: myName, type: 'img', val: e.target.result });
            reader.readAsDataURL(input.files[0]);
        }

        function sendChallenge() {
            if(!partner) return alert("Search a partner first!");
            const challenges = ["5 min Tapping Battle!", "Stone Paper Scissors NOW!", "Who types faster?"];
            const c = challenges[Math.floor(Math.random()*challenges.length)];
            pushMsg({ from: myName, type: 'challenge', val: c });
        }

        function pushMsg(data) {
            const chatId = [myName, partner].sort().join("_");
            db.ref('chats/' + chatId).push(data);
        }

        document.getElementById('msgIn').addEventListener("keypress", e => { if(e.key === "Enter") sendText(); });
    </script>
</body>
</html>
